<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Login - Digital Teknologi Perkasa Log Monitoring</title>
    <meta name="description" content="Sistem pencatatan bug dan monitoring log terintegrasi untuk ekosistem yang ada di PT. Digital Teknologi Perkasa. Dirancang untuk mempercepat identifikasi masalah dan kolaborasi tim secara real-time." />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://github.com/thealfin/Monitoring-Log-Error-Bug-Digital-Teknologi-Perkasa" />
    <meta property="og:title" content="Digital Teknologi Perkasa - Log Monitoring & Bug Tracker" />
    <meta property="og:description" content="Sistem monitoring log dan tracker bug profesional untuk ekosistem PT. Digital Teknologi Perkasa. Real-time, aman, dan efisien." />
    <meta property="og:image" content="https://raw.githubusercontent.com/thealfin/Monitoring-Log-Error-Bug-Digital-Teknologi-Perkasa/main/media/digitek%20putih.webp" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="Digital Teknologi Perkasa - Log Monitoring & Bug Tracker" />
    <meta property="twitter:description" content="Sistem monitoring log dan tracker bug profesional untuk ekosistem PT. Digital Teknologi Perkasa." />
    <meta property="twitter:image" content="https://raw.githubusercontent.com/thealfin/Monitoring-Log-Error-Bug-Digital-Teknologi-Perkasa/main/media/digitek%20putih.webp" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            font-size: 24px;
        }
        :root {
            --primary-accent: #001D1A;
            --bg-light: #F9FAFB;
            --card-light: #FFFFFF;
        }

        /* Fix blinking cursor/caret bug on text and icons */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            cursor: default;
            caret-color: transparent;
        }

        input,
        textarea,
        [contenteditable="true"],
        .selectable-text {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            cursor: text;
            caret-color: auto;
        }

        .material-symbols-outlined {
            user-select: none;
            cursor: default;
        }

        /* Dark mode specific styles */
        .dark .bg-white { background-color: #1e1e1e !important; }
        .dark .bg-gray-50 { background-color: #252525 !important; }
        .dark .border-gray-100 { border-color: #2d2d2d !important; }
        .dark .border-gray-200 { border-color: #333333 !important; }
        .dark .text-gray-900 { color: #ffffff !important; }
        .dark .text-gray-700 { color: #d1d5db !important; }
        .dark .text-gray-600 { color: #9ca3af !important; }
        .dark .placeholder-gray-400::placeholder { color: #6b7280 !important; }
    </style>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#001D1A",
                        "brand-green": "#008f80",
                        "background-light": "#f6f7f7",
                        "background-dark": "#16181c",
                    },
                    fontFamily: {
                        display: ["Inter", "sans-serif"]
                    }
                },
            },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-white min-h-screen transition-colors duration-300">
    <div class="absolute top-6 right-6 z-50">
        <button onclick="toggleDarkMode()" class="p-2.5 rounded-full bg-white dark:bg-[#1e1e1e] shadow-sm border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#252525] transition-colors">
            <span id="dark-mode-icon" class="material-symbols-outlined">dark_mode</span>
        </button>
    </div>

    <div class="flex min-h-screen">
        <!-- LEFT SIDE: BRANDING -->
        <div class="hidden lg:flex lg:w-1/2 relative bg-gradient-to-br from-[#003d38] to-[#001D1A] overflow-hidden items-center justify-center">
            <div class="absolute inset-0 overflow-hidden opacity-30 pointer-events-none">
                <div class="absolute -top-[10%] -left-[10%] w-[50%] h-[50%] rounded-full bg-emerald-400 blur-[120px]"></div>
                <div class="absolute -bottom-[10%] -right-[10%] w-[40%] h-[40%] rounded-full bg-emerald-600 blur-[100px]"></div>
            </div>
            <div class="relative z-10 px-12 text-center max-w-lg">
                <div class="mb-10 flex justify-center">
                    <div class="bg-center bg-no-repeat aspect-square bg-contain rounded-2xl size-24 bg-[#121417] p-4 shadow-2xl border border-white/10" style='background-image: url("media/digitek putih.webp");'></div>
                </div>
                <h1 class="text-4xl font-extrabold text-white mb-6 leading-tight tracking-tight">Monitoring<br>Log Error & Bug</h1>
                <p class="text-xl text-emerald-50 font-light leading-relaxed">
                    By PT. Digital Teknologi Perkasa<br>Manage and Track Your Systems Effectively
                </p>
                <div class="mt-12 flex items-center justify-center gap-4 text-emerald-200/60">
                    <span class="material-symbols-outlined">security</span>
                    <span class="text-sm font-medium tracking-widest uppercase">High Performance Bug Tracking</span>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE: LOGIN FORM -->
        <div class="flex-1 flex flex-col justify-center items-center p-6 sm:p-12 md:p-20">
            <div class="w-full max-w-[440px]">
                <div class="lg:hidden flex flex-col items-center mb-8">
                    <div class="bg-center bg-no-repeat aspect-square bg-contain rounded-xl size-14 mb-4 bg-[#121417] p-2 border border-gray-100 dark:border-gray-800 shadow-md" style='background-image: url("media/digitek putih.webp");'></div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Digital Teknologi Perkasa</h2>
                    <p class="text-emerald-700 dark:text-emerald-400 text-sm font-medium">Log Monitoring</p>
                </div>
                
                <div class="mb-10 text-center lg:text-left">
                    <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white mb-2">Welcome</h2>
                    <p class="text-gray-600 dark:text-gray-400">Please enter your details to sign in.</p>
                </div>

                <div class="bg-white dark:bg-[#1e1e1e] p-8 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800">
                    <!-- Error Message (hidden by default) -->
                    <div id="error-box" class="hidden mb-6 p-4 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-100 dark:border-red-900/30 flex items-start gap-3">
                        <span class="material-symbols-outlined text-red-500 text-xl mt-0.5">error</span>
                        <p class="text-sm font-medium text-red-600 dark:text-red-400 leading-snug">
                            Email atau kata sandi yang Anda masukkan salah. Silakan coba lagi.
                        </p>
                    </div>

                    <form id="login-form" class="space-y-6" onsubmit="handleLogin(event)">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="email">Email Address</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <span class="material-symbols-outlined text-gray-400 dark:text-gray-500 text-lg">alternate_email</span>
                                </div>
                                <input class="w-full bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3.5 pl-11 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-600 transition-all" id="email" placeholder="Masukan Email Anda" type="email" required />
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2" for="password">Password</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <span class="material-symbols-outlined text-gray-400 dark:text-gray-500 text-lg">lock</span>
                                </div>
                                <input class="w-full bg-gray-50 dark:bg-[#252525] border border-gray-200 dark:border-gray-700 rounded-xl px-4 py-3.5 pl-11 pr-11 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-600 transition-all" id="password" placeholder="••••••••" type="password" required />
                                <button type="button" onclick="togglePasswordVisibility()" class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-emerald-500 transition-colors">
                                    <span id="password-toggle-icon" class="material-symbols-outlined text-xl">visibility</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center justify-between py-1">
                            <div class="flex items-center">
                                <input class="h-4 w-4 rounded border-gray-300 bg-white dark:bg-[#252525] text-emerald-600 focus:ring-emerald-500/20 focus:ring-offset-0" id="remember-me" name="remember-me" type="checkbox" />
                                <label class="ml-2 block text-sm text-gray-600 dark:text-gray-400" for="remember-me">Remember me</label>
                            </div>
                            <a class="text-sm font-semibold text-emerald-700 dark:text-emerald-400 hover:text-emerald-600 transition-colors" href="#">Forgot password?</a>
                        </div>
                        <button class="w-full bg-primary hover:bg-[#003d38] text-white font-bold py-4 rounded-xl shadow-lg shadow-emerald-900/10 transition-all flex items-center justify-center gap-2 group" type="submit">
                            <span>Log In</span>
                        </button>
                    </form>
                </div>
                <div class="mt-10 text-center">
                    <p class="text-sm text-gray-500 dark:text-gray-500">
                        © 2026 Digital Teknologi Perkasa. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true' || 
            (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            updateDarkModeIcon(true);
        }

        function toggleDarkMode() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
            updateDarkModeIcon(isDark);
        }

        function updateDarkModeIcon(isDark) {
            const icon = document.getElementById('dark-mode-icon');
            icon.textContent = isDark ? 'light_mode' : 'dark_mode';
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('password-toggle-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.textContent = 'visibility_off';
            } else {
                passwordInput.type = 'password';
                toggleIcon.textContent = 'visibility';
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const errorBox = document.getElementById('error-box');
            const btn = event.target.querySelector('button');

            console.log("Mencoba login untuk:", email);

            try {
                btn.disabled = true;
                btn.innerHTML = '<span>Logging in...</span>';

                // 1. Authenticate with Supabase Auth
                const { data: authData, error: authError } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });

                if (authError) {
                    console.error("Auth Error Detail:", authError);
                    if (authError.status === 400) {
                        throw new Error("Email atau Password salah, atau Key Supabase tidak valid.");
                    }
                    throw authError;
                }

                console.log("Auth berhasil, mengambil profil...");

                // 2. Fetch User Role from profiles table
                const { data: profileData, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('role')
                    .eq('id', authData.user.id)
                    .single();

                if (profileError) {
                    console.error("Profile Error:", profileError.message);
                    throw profileError;
                }

                console.log("Login sukses! Role:", profileData.role);

                // 3. Redirect based on role
                if (profileData.role === 'Editor') {
                    window.location.href = 'editor access.html';
                } else {
                    window.location.href = 'viewer access.html';
                }

            } catch (error) {
                console.error('Login error detail:', error);
                errorBox.classList.remove('hidden');
                const errorText = errorBox.querySelector('p');
                if (errorText) {
                    errorText.textContent = 'Gagal Login: ' + error.message;
                }
                
                btn.disabled = false;
                btn.innerHTML = '<span>Log In</span>';
                
                const form = document.getElementById('login-form');
                form.classList.add('shake');
                setTimeout(() => form.classList.remove('shake'), 500);
            }
        }
    </script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }
    </style>
</body>
</html>